// ⚠️ MODÈLE TENANT - Créé dynamiquement par tenantService.ts
// Compte utilisateur lié à un employé, dans le schéma de l'organisation

// Rôles utilisateur métier
enum TenantUserRole {
  ADMIN // Administrateur/Propriétaire de l'organisation
  STORE_MANAGER // Gérant de boutique(s) - gestion complète de sa/ses boutique(s)
  STOCK_MANAGER // Responsable stock - gestion achats, stocks, inventaires
  SELLER // Vendeur/Caissier - ventes, caisse, relation client
  ACCOUNTANT // Comptable - rapports financiers, paiements
  USER // Utilisateur standard - consultation uniquement
}

model TenantUser {
  id         String         @id @default(uuid())
  employeeId String         @unique
  email      String         @unique
  password   String
  role       TenantUserRole @default(USER)
  isBlocked  Boolean        @default(false)
  isOwner    Boolean        @default(false)

  // Scope global (accès à toutes les boutiques - pour ADMIN/OWNER)
  globalScope Boolean @default(false)

  // Permissions custom optionnelles (format: ["module:action"])
  // Permet d'ajouter/retirer des permissions spécifiques au-delà du rôle
  customPermissions Json @default("[]")

  // PIN pour authentification rapide sur caisse (4-6 chiffres)
  pin String? @unique

  // Relations
  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  lastLoginAt DateTime?

  // Boutique d'affectation (travail)
  magasin_id String?
  magasin    magasin? @relation("UserMagasin", fields: [magasin_id], references: [id])

  // Boutiques où l'utilisateur est gérant (pour STORE_MANAGER)
  magasins_geres magasin[] @relation("MagasinGerant")

  mouvements_stock mouvements_stock[]
  ventes           vente[]
  audit_logs       audit_log[]
  sessions_caisse  session_caisse[]
  magasins         magasin[]

  @@map("tenant_users")
}
