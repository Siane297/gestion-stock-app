enum TypeMouvementStock {
    ENTREE_ACHAT
    ENTREE_INITIALE
    ENTREE_RETOUR
    SORTIE_VENTE
    SORTIE_PERISSABLE
    AJUSTEMENT
    TRANSFERT
}

model stock_magasin {
    id                String   @id @default(uuid())
    magasin_id        String
    produit_id        String
    quantite          Int      @default(0)
    quantite_minimum  Int      @default(0)
    quantite_maximum  Int?
    date_creation     DateTime @default(now())
    date_modification DateTime @updatedAt

    magasin magasin @relation(fields: [magasin_id], references: [id], onDelete: Cascade)
    produit produit @relation(fields: [produit_id], references: [id], onDelete: Cascade)

    @@unique([magasin_id, produit_id])
    @@index([magasin_id])
    @@index([produit_id])
    @@map("stocks_magasin")
}

model mouvements_stock {
    id             String             @id @default(uuid())
    magasin_id     String
    produit_id     String
    utilisateur_id String?
    lot_id         String? // Optionnel
    type           TypeMouvementStock
    quantite       Int
    vente_id       String?
    achat_id       String?
    raison         String?
    date_creation  DateTime           @default(now())

    magasin     magasin      @relation(fields: [magasin_id], references: [id], onDelete: Cascade)
    produit     produit      @relation(fields: [produit_id], references: [id], onDelete: Cascade)
    utilisateur TenantUser?  @relation(fields: [utilisateur_id], references: [id])
    lot         lot_produit? @relation(fields: [lot_id], references: [id])

    @@index([magasin_id, produit_id])
    @@index([date_creation])
    @@map("mouvements_stock")
}

model stock_lot {
    id         String @id @default(uuid())
    magasin_id String
    lot_id     String
    quantite   Float  @default(0) // Float pour gérer les décimales si besoin, même si stock_magasin est Int (on devrait peut-être aligner)

    magasin magasin     @relation(fields: [magasin_id], references: [id], onDelete: Cascade)
    lot     lot_produit @relation(fields: [lot_id], references: [id], onDelete: Cascade)

    @@unique([magasin_id, lot_id])
    @@map("stocks_lot")
}
